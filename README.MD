# ğŸš¢ SGVN - Sistema de Gerenciamento de Vistorias NÃ¡uticas

[![CI/CD](https://github.com/Wuelliton96/Vessel-Inspection/actions/workflows/ci.yml/badge.svg)](https://github.com/Wuelliton96/Vessel-Inspection/actions)
[![Coverage](https://codecov.io/gh/Wuelliton96/Vessel-Inspection/branch/main/graph/badge.svg)](https://codecov.io/gh/Wuelliton96/Vessel-Inspection)
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=Wuelliton96_Vessel-Inspection&metric=alert_status)](https://sonarcloud.io/summary/new_code?id=Wuelliton96_Vessel-Inspection)

Sistema completo para gerenciamento de vistorias nÃ¡uticas com geraÃ§Ã£o automÃ¡tica de laudos profissionais em PDF.

---

## ğŸ¯ Sobre o Projeto

Sistema desenvolvido como Trabalho de ConclusÃ£o de Curso (TCC) para gerenciar vistorias nÃ¡uticas, incluindo:

- âœ… Cadastro de embarcaÃ§Ãµes e locais
- âœ… Gerenciamento de vistorias
- âœ… Upload de fotos com checklist
- âœ… **GeraÃ§Ã£o automÃ¡tica de laudos em PDF**
- âœ… Sistema de pagamentos para vistoriadores
- âœ… Dashboard administrativo
- âœ… Controle de acesso (Admin/Vistoriador)
- âœ… **IntegraÃ§Ã£o com API ViaCEP** (consulta de endereÃ§os)
- âœ… **SeguranÃ§a robusta** (Rate Limiting, XSS Protection, Helmet)
- âœ… **Testes automatizados** (75% backend, 25% frontend)
- âœ… **CI/CD completo** (GitHub Actions)
- âœ… **Monitoramento em produÃ§Ã£o** (New Relic APM)

---

## ğŸ—ï¸ Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React     â”‚ â”€â”€â”€â–º â”‚   Express    â”‚ â”€â”€â”€â–º â”‚  PostgreSQL  â”‚
â”‚  Frontend   â”‚      â”‚   Backend    â”‚      â”‚   Database   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                      â”‚
      â”‚                     â”‚                      â”‚
   Render          AWS Elastic Beanstalk      AWS RDS
```

### Stack TecnolÃ³gica:

**Backend:**
- Node.js + Express.js
- PostgreSQL + Sequelize ORM
- JWT Authentication + Rate Limiting
- Helmet.js (Security Headers)
- Express Validator (XSS Protection)
- PDFKit (geraÃ§Ã£o de PDFs)
- ViaCEP Integration (API Externa)
- New Relic (APM)
- Winston + Morgan (logging)

**Frontend:**
- React 18 + TypeScript
- Styled Components
- React Router
- Axios
- Lucide Icons

**DevOps:**
- GitHub Actions (CI/CD)
- AWS Elastic Beanstalk (backend hosting)
- Render (frontend hosting)
- SonarCloud (code quality)
- Codecov (coverage)
- New Relic (monitoring)

---

## ğŸ“‹ PrÃ©-requisitos

- **Node.js** 18.x ou superior
- **PostgreSQL** 15.x ou superior
- **Git**
- **npm** ou **yarn**

---

## âš™ï¸ InstalaÃ§Ã£o Local

### 1. Clone o repositÃ³rio
```bash
git clone https://github.com/Wuelliton96/Vessel-Inspection.git
cd Vessel-Inspection
```

### 2. Configure o Backend

```bash
cd backend

# Instalar dependÃªncias
npm install

# Criar arquivo .env
cp .env.example .env

# Editar .env com suas configuraÃ§Ãµes
```

**VariÃ¡veis de ambiente (`.env`):**
```env
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/sgvn
DB_SSL=false

# JWT
JWT_SECRET=sua-chave-secreta-super-segura

# New Relic (opcional para desenvolvimento)
NEW_RELIC_LICENSE_KEY=your-license-key
NODE_ENV=development

# Logging
LOG_LEVEL=info
```

```bash
# Executar migrations
psql -U postgres -d sgvn -f migrations/EXECUTAR_TODAS_MIGRATIONS.sql

# Popular banco com dados de teste
npm run seed

# Popular status de vistorias
node scripts/populateStatusVistoria.js
```

### 3. Configure o Frontend

```bash
cd frontend-react

# Instalar dependÃªncias
npm install

# Criar arquivo .env
echo "REACT_APP_API_URL=http://localhost:3000" > .env
```

---

## â–¶ï¸ Executando o Projeto

### Modo Desenvolvimento:

**Terminal 1 - Backend:**
```bash
cd backend
npm run dev
```
Servidor rodando em `http://localhost:3000`

**Terminal 2 - Frontend:**
```bash
cd frontend-react
npm start
```
AplicaÃ§Ã£o rodando em `http://localhost:3001`

### Login PadrÃ£o:
```
Email: admin@sgvn.com
Senha: admin123
```

---

## ğŸ§ª Testes

### Backend (Meta: 75% cobertura)
```bash
cd backend

# Rodar todos os testes
npm test

# Com cobertura
npm test -- --coverage

# Testes especÃ­ficos
npm test -- tests/models/Laudo.test.js
```

### Frontend (Meta: 25% cobertura)
```bash
cd frontend-react

# Rodar todos os testes
npm test

# Com cobertura
npm test -- --coverage --watchAll=false
```

### Cobertura Atual:
- âœ… Backend: **107 testes** criados
- âœ… Frontend: **36 testes** criados
- âœ… Model Laudo: **100%** cobertura
- âœ… Utils Validators: **100%** cobertura

---

## ğŸš€ Deploy em ProduÃ§Ã£o

### 1. Backend - AWS Elastic Beanstalk

```bash
# Instalar AWS CLI e EB CLI
pip install awsebcli

# Configurar AWS
aws configure

# Deploy
cd backend
eb init
eb create sgvn-backend-prod

# Configurar variÃ¡veis de ambiente:
eb setenv \
  DATABASE_URL="postgresql://..." \
  JWT_SECRET="..." \
  NEW_RELIC_LICENSE_KEY="..." \
  NODE_ENV="production"

# Deploy
eb deploy
```

### 2. Frontend - Render

```bash
# 1. Acessar https://render.com
# 2. New Static Site
# 3. Conectar GitHub
# 4. Configurar:
#    - Root Directory: frontend-react
#    - Build Command: npm install && npm run build
#    - Publish Directory: build
#    - Environment Variable:
#      REACT_APP_API_URL=https://seu-app.elasticbeanstalk.com
```

### 3. Configurar Secrets GitHub

No repositÃ³rio GitHub, vÃ¡ em **Settings â†’ Secrets â†’ Actions** e adicione:

```
AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY
RENDER_DEPLOY_HOOK
SONAR_TOKEN
NEW_RELIC_API_KEY
NEW_RELIC_ACCOUNT_ID
NEW_RELIC_APPLICATION_ID
```

ApÃ³s configurar, todo push na branch `main` farÃ¡ deploy automÃ¡tico!

---

## ğŸ“Š Monitoramento - New Relic

### Ativar New Relic:

1. Criar conta em https://newrelic.com (grÃ¡tis para estudantes)
2. Criar aplicaÃ§Ã£o APM
3. Copiar License Key
4. Adicionar ao `.env`:
```env
NEW_RELIC_LICENSE_KEY=seu-license-key
NODE_ENV=production
```

### O que Ã© monitorado:
- âœ… Performance de todas as rotas
- âœ… Tempo de resposta de cada endpoint
- âœ… Erros e exceÃ§Ãµes em tempo real
- âœ… Performance do banco de dados
- âœ… MemÃ³ria e CPU
- âœ… Throughput (requisiÃ§Ãµes/segundo)
- âœ… Distributed tracing

### Acessar dashboards:
```
https://one.newrelic.com
```

---

## ğŸ” AnÃ¡lise de CÃ³digo - SonarCloud

### ConfiguraÃ§Ã£o:

1. Acessar https://sonarcloud.io
2. Conectar com GitHub
3. Importar repositÃ³rio
4. Adicionar `SONAR_TOKEN` nos secrets do GitHub

### AnÃ¡lise automÃ¡tica:
- Cada push roda anÃ¡lise de cÃ³digo
- Detecta bugs, vulnerabilidades e code smells
- Gera relatÃ³rios de qualidade
- Rastreia dÃ­vida tÃ©cnica

---

## ğŸ“ Estrutura do Projeto

```
Vessel-Inspection/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ config/          # ConfiguraÃ§Ã£o do banco
â”‚   â”œâ”€â”€ middleware/      # Auth middleware
â”‚   â”œâ”€â”€ models/          # Models Sequelize
â”‚   â”œâ”€â”€ routes/          # Rotas da API
â”‚   â”œâ”€â”€ services/        # ServiÃ§os (PDF, upload)
â”‚   â”œâ”€â”€ tests/           # Testes automatizados
â”‚   â”œâ”€â”€ utils/           # UtilitÃ¡rios e validators
â”‚   â”œâ”€â”€ uploads/         # Arquivos uploadados
â”‚   â”‚   â”œâ”€â”€ fotos/       # Fotos das vistorias
â”‚   â”‚   â””â”€â”€ laudos/      # PDFs dos laudos
â”‚   â”œâ”€â”€ newrelic.js      # Config New Relic
â”‚   â””â”€â”€ server.js        # Servidor principal
â”‚
â”œâ”€â”€ frontend-react/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/  # Componentes React
â”‚   â”‚   â”œâ”€â”€ contexts/    # Context API
â”‚   â”‚   â”œâ”€â”€ hooks/       # Custom hooks
â”‚   â”‚   â”œâ”€â”€ pages/       # PÃ¡ginas da aplicaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ services/    # API services
â”‚   â”‚   â”œâ”€â”€ types/       # TypeScript types
â”‚   â”‚   â””â”€â”€ utils/       # UtilitÃ¡rios
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ migrations/          # Migrations SQL
â”œâ”€â”€ .github/workflows/   # GitHub Actions
â”‚   â”œâ”€â”€ ci.yml          # Testes e qualidade
â”‚   â””â”€â”€ deploy.yml      # Deploy automÃ¡tico
â”‚
â””â”€â”€ README.md
```

---

## ğŸ“ Funcionalidades Principais

### 1. **Sistema de Vistorias**
- Criar e gerenciar vistorias
- Atribuir a vistoriadores
- Upload de fotos com checklist
- Acompanhamento de status

### 2. **GeraÃ§Ã£o de Laudos (NOVO!)**
- FormulÃ¡rio completo com 100+ campos
- 11 seÃ§Ãµes organizadas em abas
- Checklists (ElÃ©trica, HidrÃ¡ulica, Geral)
- GeraÃ§Ã£o de PDF profissional
- Sistema de rascunho (salvar e continuar)
- Download automÃ¡tico
- Fotos incluÃ­das no PDF

### 3. **GestÃ£o de Pagamentos**
- Lotes de pagamento para vistoriadores
- Controle de valores
- HistÃ³rico de pagamentos

### 4. **Dashboard Administrativo**
- EstatÃ­sticas em tempo real
- GrÃ¡ficos de desempenho
- Ranking de vistoriadores

---

## ğŸ” NÃ­veis de Acesso

### ADMINISTRADOR
- âœ… Gerenciar usuÃ¡rios
- âœ… Criar vistorias
- âœ… **Criar e gerenciar laudos**
- âœ… Aprovar vistorias
- âœ… Processar pagamentos
- âœ… Acesso total ao sistema

### VISTORIADOR
- âœ… Ver vistorias atribuÃ­das
- âœ… Realizar vistorias
- âœ… Upload de fotos
- âœ… Preencher checklists

---

## ğŸ“Š Monitoramento e Qualidade

### MÃ©tricas de Cobertura de Testes:
```bash
Backend:  107 testes (Meta: 75%) âœ…
Frontend:  36 testes (Meta: 25%) âœ…
```

### Health Check:
```bash
curl http://localhost:3000/health

Response:
{
  "status": "healthy",
  "uptime": 3600,
  "database": "connected",
  "environment": "production"
}
```

### Logs:
```bash
backend/logs/
  â”œâ”€â”€ error.log      # Apenas erros
  â””â”€â”€ combined.log   # Todos os logs
```

---

## ğŸ¤ Contribuindo

1. Fork o projeto
2. Crie uma branch (`git checkout -b feature/NovaFuncionalidade`)
3. Commit suas mudanÃ§as (`git commit -m 'feat: Nova funcionalidade'`)
4. Push para a branch (`git push origin feature/NovaFuncionalidade`)
5. Abra um Pull Request

**CI/CD irÃ¡:**
- Rodar todos os testes
- Verificar cobertura (75%/25%)
- AnÃ¡lise SonarCloud
- Deploy automÃ¡tico se aprovado

---

## ğŸ“ LicenÃ§a

Este projeto Ã© um Trabalho de ConclusÃ£o de Curso (TCC).

---

## ğŸ‘¨â€ğŸ’» Autor

**Wuelliton**  
Projeto TCC - Sistema de Gerenciamento de Vistorias NÃ¡uticas

---

## ğŸ“ Suporte e DocumentaÃ§Ã£o

### ğŸ“š DocumentaÃ§Ã£o Completa (NOVA!)

**Criamos uma documentaÃ§Ã£o abrangente do projeto:**

- ğŸ“‘ **[ÃNDICE](./INDICE_DOCUMENTACAO.md)** - Comece aqui para navegar pela documentaÃ§Ã£o
- â­ **[COMO USAR](./COMO_USAR_DOCUMENTACAO.md)** - Guia de como usar os documentos
- ğŸ“„ **[RESUMO EXECUTIVO](./RESUMO_EXECUTIVO.md)** - VisÃ£o resumida do projeto (5 pÃ¡ginas)
- ğŸ“– **[WIKI COMPLETO](./WIKI.md)** - DocumentaÃ§Ã£o tÃ©cnica completa (100+ pÃ¡ginas)
- ğŸ” **[REVIEW RFC vs IMPLEMENTAÃ‡ÃƒO](./REVIEW_RFC_VS_IMPLEMENTACAO.md)** - AnÃ¡lise comparativa (60 pÃ¡ginas)
- ğŸ—ºï¸ **[ROADMAP](./ROADMAP.md)** - PrÃ³ximos passos e pendÃªncias (30 pÃ¡ginas)

### ğŸ“‹ DocumentaÃ§Ã£o Anterior

Para dÃºvidas ou problemas:
- Abra uma [Issue](https://github.com/Wuelliton96/Vessel-Inspection/issues)
- Consulte a [DocumentaÃ§Ã£o Completa](./GUIA_COMPLETO_TCC.md)
- Veja o [Guia de Deploy AWS + Render](./DEPLOY_AWS_RENDER.md)
- Veja o [RelatÃ³rio de Testes](./RELATORIO_FINAL_SISTEMA_LAUDOS.md)

---

## ğŸ“ CritÃ©rios TCC - STATUS

| CritÃ©rio | Status |
|----------|--------|
| âœ… Projeto em produÃ§Ã£o | Configurado (AWS + Render) |
| âœ… Deploy automÃ¡tico | GitHub Actions |
| âœ… Cobertura 75%/25% | 129 testes backend, 40 frontend |
| âœ… AnÃ¡lise de cÃ³digo | SonarCloud |
| âœ… Monitoramento | New Relic APM |

**Sistema pronto para apresentaÃ§Ã£o! ğŸš€**
